<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.w3.org/1999/xhtml">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quản lý chấm công - Hệ Thống Quản Lý Nhân Sự</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <!-- DataTables CSS -->
  <link href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css" rel="stylesheet">
  <!-- Vanilla Calendar CSS -->
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@uvarov.frontend/vanilla-calendar/build/vanilla-calendar.min.css">
  <link rel="stylesheet" href="/css/style.css">

  <style>
    /* Root Variables for Consistent Theming */
    :root {
      --primary-color: #4e73df;
      --primary-dark: #3756b5;
      --secondary-color: #858796;
      --success-color: #28a745;
      --warning-color: #ffc107;
      --danger-color: #dc3545;
      --info-color: #17a2b8;
      --light-color: #f8f9fc;
      --dark-color: #5a5c69;
      --shadow-sm: 0 .125rem .25rem rgba(0, 0, 0, 0.075);
      --shadow-md: 0 .5rem 1rem rgba(0, 0, 0, 0.15);
      --border-radius: 0.35rem;
      --transition: all 0.3s ease-in-out;
    }


    /* Employee List Improvements */
    .employee-list {
      height: calc(100vh - 200px);
      overflow-y: auto;
      padding: 0.5rem;
      scrollbar-width: thin;
      scrollbar-color: var(--secondary-color) transparent;
    }

    .employee-item {
      padding: 1rem;
      border: 1px solid #e3e6f0;
      margin-bottom: 0.75rem;
      border-radius: var(--border-radius);
      background: white;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .employee-item:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-sm);
      border-color: var(--primary-color);
    }

    .employee-item.active {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
      color: white;
    }

    .employee-item.active .text-muted {
      color: rgba(255, 255, 255, 0.7) !important;
    }

    .employee-avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #e3e6f0;
    }

    /* Calendar Container Improvements */
    /* Container cho lịch */
    .calendar-container {
      background: white;
      padding: 1.5rem;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-sm);
      margin-top: 1rem;
      width: 100%;
    }

    /* Điều chỉnh calendar */
    .vanilla-calendar {
      font-family: inherit;
      padding: 1rem;
      width: 100%;
    }

    /* Điều chỉnh grid của lịch */
    .vanilla-calendar-week,
    .vanilla-calendar-days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }

    /* Điều chỉnh từng ô ngày */
    .vanilla-calendar-day {
      position: relative;
      aspect-ratio: 1.5;
      /* Tạo tỷ lệ khung hình ngang */
      padding: 1rem !important;
      border-radius: var(--border-radius);
      font-size: 1.1rem;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    /* Attendance Status Indicators */
    .attendance-status {
      position: absolute;
      bottom: 4px;
      right: 4px;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      box-shadow: var(--shadow-sm);
    }

    .status-present {
      background-color: var(--success-color);
    }

    .status-late {
      background-color: var(--warning-color);
    }

    .status-absent {
      background-color: var(--danger-color);
    }

    .status-overtime {
      background-color: var(--info-color);
    }

    /* Button Group Improvements */
    .btn-group {
      box-shadow: var(--shadow-sm);
      border-radius: var(--border-radius);
      overflow: hidden;
    }

    .btn-group .btn {
      padding: 0.5rem 1rem;
      font-weight: 500;
      border: none;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Modal Improvements */
    .modal-content {
      border: none;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-md);
    }

    .modal-header {
      background-color: var(--primary-color);
      color: white;
      border-bottom: none;
      border-radius: var(--border-radius) var(--border-radius) 0 0;
    }

    .modal-header .btn-close {
      filter: brightness(0) invert(1);
    }

    /* Form Controls */
    .form-control,
    .form-select {
      border-radius: var(--border-radius);
      border-color: #e3e6f0;
      padding: 0.75rem;
      transition: var(--transition);
    }

    .form-control:focus,
    .form-select:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.25);
    }

    /* Legend Improvements */
    .attendance-legend {
      background-color: var(--light-color);
      padding: 1rem;
      border-radius: var(--border-radius);
      margin-bottom: 1rem;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
    }

    .legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .content-wrapper {
        margin-left: 0;
      }

      .sidebar.show {
        transform: translateX(0);
      }

      .employee-list {
        height: 400px;
      }

      .vanilla-calendar-day {
        aspect-ratio: 1;
        /* Trở lại tỷ lệ vuông trên mobile */
        font-size: 0.9rem;
        padding: 0.5rem !important;
      }
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--secondary-color);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--primary-dark);
    }

    /* Animation Effects */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .employee-item,
    .calendar-container,
    .modal-content {
      animation: fadeIn 0.3s ease-out;
    }
  </style>
</head>

<body>
<div id="wrapper">
  <!-- Sidebar -->
  <div th:replace="~{layout/sidebar :: sidebar}"></div>
  <!-- Content Wrapper -->
  <div class="content-wrapper">
    <div class="container-fluid">
      <!-- Page Heading -->
      <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">Quản lý chấm công</h1>
        <div>
          <button class="btn btn-success btn-sm me-2">
            <i class="bi bi-qr-code-scan"></i> Chấm công QR
          </button>
          <button class="btn btn-primary btn-sm" data-bs-toggle="modal"
                  data-bs-target="#addEmployeeModal">
            <i class="bi bi-plus-lg"></i> Thêm nhân viên
          </button>
        </div>
      </div>

      <!-- Main Content -->
      <div class="row">
        <!-- Employee List -->
        <div class="col-md-3">
          <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex justify-content-between align-items-center">
              <h6 class="m-0 font-weight-bold text-primary">Danh sách nhân viên</h6>
              <div class="form-group mb-0">
                <input type="text" class="form-control form-control-sm" id="employeeSearch"
                       placeholder="Tìm kiếm...">
              </div>
            </div>
            <div class="card-body p-0">
              <div class="employee-list" id="employeeList">
                <!-- Employee items will be generated here -->
              </div>
            </div>
          </div>
        </div>

        <!-- Calendar View -->
        <div class="col-md-9">
          <div class="card shadow mb-4">
            <div class="card-header py-3">
              <h6 class="m-0 font-weight-bold text-primary">Lịch chấm công - <span
                      id="selectedEmployeeName">Chưa chọn nhân viên</span></h6>
            </div>
            <div class="card-body">
              <div class="attendance-legend d-flex justify-content-between">
                <div class="legend-item">
                  <span class="legend-dot status-present"></span>
                  <span>Đúng giờ</span>
                </div>
                <div class="legend-item">
                  <span class="legend-dot status-late"></span>
                  <span>Đi muộn</span>
                </div>
                <div class="legend-item">
                  <span class="legend-dot status-absent"></span>
                  <span>Vắng mặt</span>
                </div>
                <div class="legend-item">
                  <span class="legend-dot status-overtime"></span>
                  <span>Tăng ca</span>
                </div>
              </div>
              <div class="calendar-container">
                <div id="myCalendar" class="vanilla-calendar"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add Attendance Modal -->
<div class="modal fade" id="addAttendanceModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Thêm chấm công</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="attendanceForm" method="post" th:action="@{/attendance/create}">
          <div class="mb-3">
            <label class="form-label">Nhân viên</label>
            <input type="text" class="form-control" id="selectedEmployeeInput" name="id" readonly>
          </div>
          <div class="mb-3">
            <label class="form-label">Ngày</label>
            <input type="date" class="form-control" id="selectedDate" name="ngay" readonly>
          </div>
          <div class="mb-3">
            <label class="form-label">Trạng thái</label>
            <select class="form-select" id="attendanceStatus" name="status">
              <option value="Đúng giờ">Đúng giờ</option>
              <option value="Muộn">Muộn</option>
              <option value="Vắng">Vắng</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Giờ vào</label>
            <input type="time" class="form-control" id="timeIn" name="in">
          </div>
          <div class="mb-3">
            <label class="form-label">Giờ ra</label>
            <input type="time" class="form-control" id="timeOut" name="out">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
            <button type="submit" class="btn btn-primary" onclick="saveAttendance()">Lưu</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- Edit Attendance Modal -->
<div class="modal fade" id="editAttendanceModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Chỉnh sửa chấm công</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="editAttendanceForm" method="post" th:action="@{/attendance/update}">
          <input type="hidden" name="mcc" id="editAttendanceId">
          <div class="mb-3">
            <label class="form-label">Nhân viên</label>
            <input type="text" class="form-control" id="editEmployeeInput" name="id" readonly>
          </div>
          <div class="mb-3">
            <label class="form-label">Ngày</label>
            <input type="date" class="form-control" id="editDate" name="ngay" readonly>
          </div>
          <div class="mb-3">
            <label class="form-label">Trạng thái</label>
            <select class="form-select" id="editAttendanceStatus" name="status">
              <option value="">Chọn trạng thái</option>
              <option value="Đúng giờ">Đúng giờ</option>
              <option value="Muộn">Muộn</option>
              <option value="Vắng">Vắng</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Giờ vào</label>
            <input type="time" class="form-control" id="editTimeIn" name="in">
          </div>
          <div class="mb-3">
            <label class="form-label">Giờ ra</label>
            <input type="time" class="form-control" id="editTimeOut" name="out">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
            <button type="submit" class="btn btn-primary" onclick="saveEditAttendance()">Lưu thay đổi</button>
          </div>
        </form>
      </div>

    </div>
  </div>
</div>

<!-- Delete Salary Modal -->
<div class="modal fade" id="deleteAttendanceModal" tabindex="-1" aria-labelledby="deleteAtendanceModalLabel"
     aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteAtendanceModalLabel">Xác nhận xóa</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Bạn có chắc chắn muốn xóa bảng chấm công này không? Hành động này không thể hoàn tác.
      </div>
      <form method="post" th:action="@{/attendance/delete}">
        <input type="hidden" name="id" id="deleteAttendanceId"  readonly>
        <input type="text"  id="deleteAttendanceDate" readonly>
        <input type="text"  id="deleteEmployeeName" readonly>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
          <button type="submit" class="btn btn-danger">Xóa</button>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- Bootstrap & Other Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@uvarov.frontend/vanilla-calendar/build/vanilla-calendar.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>

<script th:inline="javascript">
  /* Tạo mảng employees từ danh sách users */
  const employees = [
    /*[# th:each="user : ${users}"]*/
    {
      id: /*[[${user.id}]]*/ 0,
      code: /*[[${user.id}]]*/ 'N/A',
      name: /*[[${user.hoTen}]]*/ 'N/A',
      department: /*[[${user.chucVu?.phongBan?.tenPhongBan}]]*/ 'N/A',
      avatar: /*[[${user.avatar}]]*/ 'https://via.placeholder.com/40'
    },
    /*[/]*/
  ];
</script>

<script>
  let selectedEmployee = null;
  let calendar = null;
  let attendanceData = {};

  // Initialize the page
  document.addEventListener('DOMContentLoaded', function () {
    initializeEmployeeList();
    initializeCalendar();
    setupSearch();
  });

  // Initialize employee list
  function initializeEmployeeList() {
    const employeeList = document.getElementById('employeeList');
    employeeList.innerHTML = employees.map(employee => `
            <div class="employee-item d-flex align-items-center" data-id="${employee.id}">
                <img src="${employee.avatar || 'https://via.placeholder.com/40'}" alt="${employee.name}" class="employee-avatar">
                <div class="employee-info">
                    <div class="fw-bold">${employee.code} - ${employee.name}</div>
                    <div class="text-muted small">${employee.department || 'Chưa có phòng ban'}</div>
                </div>
            </div>
        `).join('');

    // Add click handlers
    document.querySelectorAll('.employee-item').forEach(item => {
      item.addEventListener('click', function () {
        const employeeId = parseInt(this.dataset.id);
        selectEmployee(employeeId);
      });
    });
  }

  // Initialize calendar
  function initializeCalendar() {
    calendar = new VanillaCalendar('#myCalendar', {
      settings: {
        lang: 'vi',
        selection: {
          day: 'single'
        }
      },
      actions: {
        clickDay(e, dates) {
          if (!selectedEmployee) {
            alert('Vui lòng chọn nhân viên trước');
            return;
          }
          const selectedDate = dates[0];
          handleAttendanceClick(selectedDate);
        }
      }
    });
    calendar.init();
  }

  // Setup search functionality
  function setupSearch() {
    const searchInput = document.getElementById('employeeSearch');
    searchInput.addEventListener('input', function (e) {
      const searchTerm = e.target.value.toLowerCase();
      document.querySelectorAll('.employee-item').forEach(item => {
        const text = item.textContent.toLowerCase();
        item.style.display = text.includes(searchTerm) ? 'flex' : 'none';
      });
    });
  }

  // Handle click on calendar day
  function handleAttendanceClick(date) {
    if (!selectedEmployee) {
      alert('Vui lòng chọn nhân viên trước');
      return;
    }

    if (!attendanceData[selectedEmployee.id]) {
      attendanceData[selectedEmployee.id] = {};
    }

    const attendance = attendanceData[selectedEmployee.id][date];
    if (attendance) {
      // Nếu đã tồn tại, hiển thị modal chỉnh sửa
      showEditAttendanceModal(date, attendance);
    } else {
      // Nếu chưa tồn tại, hiển thị modal thêm mới
      showAttendanceModal(date);
    }
  }

  // Select employee function
  function selectEmployee(employeeId) {
    const employee = employees.find(emp => emp.id === employeeId);
    if (!employee) return;

    // Update UI
    document.querySelectorAll('.employee-item').forEach(item => {
      item.classList.remove('active');
    });
    document.querySelector(`.employee-item[data-id="${employeeId}"]`).classList.add('active');

    // Update selected employee
    selectedEmployee = employee;
    document.getElementById('selectedEmployeeName').textContent = `${employee.code} - ${employee.name}`;

    // Load attendance data for this employee
    loadAttendanceData(employeeId);
  }

  // Show add attendance modal
  function showAttendanceModal(date) {
    document.getElementById('selectedEmployeeInput').value = `${selectedEmployee.code} - ${selectedEmployee.name}`;
    document.getElementById('selectedDate').value = date;
    const modal = new bootstrap.Modal(document.getElementById('addAttendanceModal'));
    modal.show();
  }

  // Show edit attendance modal
  function showEditAttendanceModal(date, attendance) {
    document.getElementById('editEmployeeInput').value = `${selectedEmployee.code} - ${selectedEmployee.name}`;
    document.getElementById('editDate').value = date;
    document.getElementById('editAttendanceStatus').value = attendance.status;
    document.getElementById('editTimeIn').value = attendance.timeIn || '';
    document.getElementById('editTimeOut').value = attendance.timeOut || '';
    document.getElementById('editNote').value = attendance.note || '';
    const modal = new bootstrap.Modal(document.getElementById('editAttendanceModal'));
    modal.show();
  }

  // Save new attendance
  function saveAttendance() {
    const date = document.getElementById('selectedDate').value;
    const status = document.getElementById('attendanceStatus').value;
    const timeIn = document.getElementById('timeIn').value;
    const timeOut = document.getElementById('timeOut').value;
    const note = document.getElementById('note').value;

    if (!attendanceData[selectedEmployee.id]) {
      attendanceData[selectedEmployee.id] = {};
    }
    attendanceData[selectedEmployee.id][date] = {
      status: status,
      timeIn: timeIn,
      timeOut: timeOut,
      note: note
    };

    updateCalendarDisplay();
    const modal = bootstrap.Modal.getInstance(document.getElementById('addAttendanceModal'));
    modal.hide();
    document.getElementById('attendanceForm').reset();
  }

  // Save edited attendance
  function saveEditAttendance() {
    const date = document.getElementById('editDate').value;
    const status = document.getElementById('editAttendanceStatus').value;
    const timeIn = document.getElementById('editTimeIn').value;
    const timeOut = document.getElementById('editTimeOut').value;
    const note = document.getElementById('editNote').value;

    if (!attendanceData[selectedEmployee.id]) {
      attendanceData[selectedEmployee.id] = {};
    }
    attendanceData[selectedEmployee.id][date] = {
      status: status,
      timeIn: timeIn,
      timeOut: timeOut,
      note: note
    };

    updateCalendarDisplay();
    const modal = bootstrap.Modal.getInstance(document.getElementById('editAttendanceModal'));
    modal.hide();
    document.getElementById('editAttendanceForm').reset();
  }

  // Mark attendance directly from buttons
  function markAttendance(status) {
    if (!selectedEmployee) {
      alert('Vui lòng chọn nhân viên trước');
      return;
    }

    const today = new Date().toISOString().split('T')[0];

    if (!attendanceData[selectedEmployee.id]) {
      attendanceData[selectedEmployee.id] = {};
    }

    let timeIn, timeOut;
    switch (status) {
      case 'present':
        timeIn = '08:00';
        timeOut = '17:00';
        break;
      case 'late':
        timeIn = '08:30';
        timeOut = '17:00';
        break;
      case 'overtime':
        timeIn = '08:00';
        timeOut = '18:00';
        break;
      case 'absent':
        timeIn = '';
        timeOut = '';
        break;
    }

    attendanceData[selectedEmployee.id][today] = {
      status: status,
      timeIn: timeIn,
      timeOut: timeOut,
      note: `Chấm công nhanh - ${status}`
    };

    updateCalendarDisplay();
  }

  // Load attendance data for an employee
  function loadAttendanceData(employeeId) {
    document.querySelectorAll('.attendance-status').forEach(el => el.remove());
    if (attendanceData[employeeId]) {
      updateCalendarDisplay();
    }
  }

  // Update calendar display
  function updateCalendarDisplay() {
    if (!selectedEmployee) return;

    document.querySelectorAll('.attendance-status').forEach(el => el.remove());

    const days = document.querySelectorAll('.vanilla-calendar-day');
    const employeeAttendance = attendanceData[selectedEmployee.id] || {};

    days.forEach(day => {
      const date = day.dataset.calendarDay;
      if (employeeAttendance[date]) {
        const attendance = employeeAttendance[date];
        const statusDot = document.createElement('span');
        statusDot.className = `attendance-status status-${attendance.status}`;

        statusDot.title = `
                    Trạng thái: ${getStatusText(attendance.status)}
                    Giờ vào: ${attendance.timeIn || 'N/A'}
                    Giờ ra: ${attendance.timeOut || 'N/A'}
                    ${attendance.note ? 'Ghi chú: ' + attendance.note : ''}
                `;

        day.appendChild(statusDot);
      }
    });
  }

  // Helper function to get status text
  function getStatusText(status) {
    const statusMap = {
      'present': 'Đi làm đúng giờ',
      'late': 'Đi muộn',
      'absent': 'Vắng mặt',
      'overtime': 'Tăng ca'
    };
    return statusMap[status] || status;
  }

  // Export attendance data
  function exportAttendance() {
    if (!selectedEmployee) {
      alert('Vui lòng chọn nhân viên trước khi xuất dữ liệu');
      return;
    }

    const employeeData = attendanceData[selectedEmployee.id];
    if (!employeeData) {
      alert('Không có dữ liệu chấm công cho nhân viên này');
      return;
    }

    let csvContent = "Ngày,Trạng thái,Giờ vào,Giờ ra,Ghi chú\n";
    Object.entries(employeeData).forEach(([date, data]) => {
      csvContent += `${date},${getStatusText(data.status)},${data.timeIn || ''},${data.timeOut || ''},${data.note || ''}\n`;
    });

    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement("a");
    if (link.download !== undefined) {
      const url = URL.createObjectURL(blob);
      link.setAttribute("href", url);
      link.setAttribute("download", `chamcong_${selectedEmployee.code}_${new Date().toISOString().split('T')[0]}.csv`);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  }

  // Add keyboard shortcuts
  document.addEventListener('keydown', function (e) {
    if (!selectedEmployee) return;

    switch (e.key) {
      case 'p':
        if (e.ctrlKey) markAttendance('present');
        break;
      case 'l':
        if (e.ctrlKey) markAttendance('late');
        break;
      case 'a':
        if (e.ctrlKey) markAttendance('absent');
        break;
      case 'o':
        if (e.ctrlKey) markAttendance('overtime');
        break;
    }
  });

  // Initialize tooltips
  document.addEventListener('DOMContentLoaded', function () {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl);
    });
  });
</script>
<script>
  // Handle click on calendar day
  function handleAttendanceClick(date) {
    if (!selectedEmployee) {
      alert('Vui lòng chọn nhân viên trước');
      return;
    }

    // Gọi API để kiểm tra xem ngày này đã được chấm công hay chưa
    fetch(`/attendance/check?employeeId=${selectedEmployee.id}&date=${date}`)
            .then(response => response.json())
            .then(data => {
              if (data.exists) {
                // Nếu đã tồn tại, hiển thị modal chỉnh sửa chấm công
                showEditAttendanceModal(date, data.attendance);
              } else {
                // Nếu chưa tồn tại, hiển thị modal thêm chấm công
                showAttendanceModal(date);
              }
            })
            .catch(error => {
              console.error('Error:', error);
              alert('Có lỗi xảy ra khi kiểm tra dữ liệu chấm công.');
            });
    function showEditAttendanceModal(date, attendance) {
      document.getElementById('editEmployeeInput').value = `${selectedEmployee.code} - ${selectedEmployee.name}`;
      document.getElementById('editDate').value = date;
      document.getElementById('editAttendanceStatus').value = attendance.status;
      document.getElementById('editTimeIn').value = attendance.timeIn || '';
      document.getElementById('editTimeOut').value = attendance.timeOut || '';
      const modal = new bootstrap.Modal(document.getElementById('editAttendanceModal'));
      modal.show();
    }
    function showAttendanceModal(date) {
      document.getElementById('selectedEmployeeInput').value = `${selectedEmployee.code} - ${selectedEmployee.name}`;
      document.getElementById('selectedDate').value = date;
      const modal = new bootstrap.Modal(document.getElementById('addAttendanceModal'));
      modal.show();
    }
  }
</script>
</body>

</html>