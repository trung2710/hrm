<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.w3.org/1999/xhtml">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quản lý chấm công - Hệ Thống Quản Lý Nhân Sự</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
<div id="wrapper">
  <!-- Content Wrapper -->
  <div class="content-wrapper">
    <div class="container-fluid">
      <!-- Page Heading -->
      <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">Quản lý chấm công</h1>
        <button class="btn btn-primary btn-sm" id="addAttendanceButton" disabled data-bs-toggle="modal"
                data-bs-target="#addAttendanceModal">
          <i class="bi bi-plus-lg"></i> Thêm bản ghi
        </button>
      </div>

      <div class="row">
        <!-- Employee List -->
        <div class="col-md-4">
          <div class="card shadow mb-4">
            <div class="card-header py-3">
              <h6 class="m-0 font-weight-bold text-primary">Danh sách nhân viên</h6>
            </div>
            <div class="card-body">
              <ul class="list-group" id="employeeList">
                <!-- Hiển thị danh sách nhân viên -->
                <li th:each="user : ${users}"
                    class="list-group-item"
                    th:attr="data-id=${user.id}, data-chamcongs=${#objects.toJson(user.chamCongs)}"
                    th:text="${user.hoTen}"
                    onclick="selectEmployee(this)">
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Attendance Records -->
        <div class="col-md-8">
          <div class="card shadow mb-4">
            <div class="card-header py-3">
              <h6 class="m-0 font-weight-bold text-primary">
                Bản chấm công - <span id="selectedEmployeeName">Chưa chọn</span>
              </h6>
            </div>
            <div class="card-body">
              <table class="table table-bordered">
                <thead>
                <tr>
                  <th>Ngày</th>
                  <th>Giờ vào</th>
                  <th>Giờ ra</th>
                  <th>Trạng thái</th>
                  <th>Thao tác</th>
                </tr>
                </thead>
                <tbody id="attendanceRecords">
                <tr>
                  <td colspan="5" class="text-center text-muted">Chọn nhân viên để hiển thị bản ghi chấm công</td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modals -->
<!-- Add Attendance Modal -->
<div class="modal fade" id="addAttendanceModal" tabindex="-1" aria-labelledby="addAttendanceModalLabel"
     aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addAttendanceModalLabel">Thêm bản chấm công</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="addAttendanceForm" method="post" th:action="@{/attendance/create}">
          <div class="mb-3">
            <label for="addAttendanceDate" class="form-label">Ngày</label>
            <input type="date" class="form-control" id="addAttendanceDate" name="ngay" required>
          </div>
          <div class="mb-3">
            <label for="addAttendanceTimeIn" class="form-label">Giờ vào</label>
            <input type="time" class="form-control" id="addAttendanceTimeIn" name="in">
          </div>
          <input type="hidden" id="selectedEmployeeId" name="id">
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
            <button type="submit" class="btn btn-primary">Lưu</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- View Attendance Modal -->
<div class="modal fade" id="viewAttendanceModal" tabindex="-1" aria-labelledby="viewAttendanceModalLabel"
     aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="viewAttendanceModalLabel">Chi tiết bản chấm công</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p><strong>Ngày:</strong> <span id="viewDate"></span></p>
        <p><strong>Giờ vào:</strong> <span id="viewTimeIn"></span></p>
        <p><strong>Giờ ra:</strong> <span id="viewTimeOut"></span></p>
        <p><strong>Trạng thái:</strong> <span id="viewStatus"></span></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap core JavaScript-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  function selectEmployee(element) {
    const employeeId = element.getAttribute('data-id');
    const employeeName = element.textContent.trim();
    const selectedEmployeeName = document.getElementById('selectedEmployeeName');
    const attendanceRecords = document.getElementById('attendanceRecords');

    // Hiển thị tên nhân viên đã chọn
    selectedEmployeeName.textContent = employeeName;

    // Kích hoạt nút thêm bản ghi
    document.getElementById('addAttendanceButton').disabled = false;

    // Lấy danh sách chấm công của nhân viên từ thuộc tính `data-chamcongs`
    const chamCongs = JSON.parse(element.getAttribute('data-chamcongs'));

    // Xóa danh sách cũ
    attendanceRecords.innerHTML = '';

    // Hiển thị danh sách chấm công mới
    if (chamCongs && chamCongs.length > 0) {
      chamCongs.forEach(record => {
        const row = document.createElement('tr');
        row.innerHTML = `
        <td>${record.ngay}</td>
        <td>${record.gioVao}</td>
        <td>${record.gioRa || 'Chưa có'}</td>
        <td>${record.trangThai}</td>
        <td>
          <button class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#viewAttendanceModal">Xem</button>
          <button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#editAttendanceModal">Sửa</button>
          <button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteAttendanceModal">Xóa</button>
        </td>
      `;
        attendanceRecords.appendChild(row);
      });
    } else {
      attendanceRecords.innerHTML = `
      <tr>
        <td colspan="5" class="text-center text-muted">Không có bản ghi chấm công</td>
      </tr>
    `;
    }
  }
</script>
</body>

</html>